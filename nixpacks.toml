[phases.setup]
nixPkgs = [
  'php83',
  'php83Packages.composer',
  'php83Extensions.curl',
  'php83Extensions.mbstring',
  'php83Extensions.zip',
  'php83Extensions.pdo',
  'php83Extensions.pdo_mysql',
  'php83Extensions.gd',
  'php83Extensions.fileinfo',
  'php83Extensions.tokenizer'
]

[phases.install]
cmds = [
  'cd backend && COMPOSER_ALLOW_SUPERUSER=1 composer install --no-dev --prefer-dist --no-interaction --no-progress --optimize-autoloader'
]

[phases.build]
cmds = [
  'cd backend && mkdir -p bootstrap/cache',
  'cd backend && php artisan key:generate --force',
  'cd backend && php artisan config:cache',
  'cd backend && php artisan route:cache'
]

[start]
cmd = 'cd backend && php artisan serve --host=0.0.0.0 --port=$PORT'
